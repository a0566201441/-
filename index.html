<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ (v5)</title>
  <style>
    body{font-family:"Segoe UI",Tahoma,Arial,sans-serif;background:#0b0f14;color:#e9eef5;margin:0;padding:20px}
    h1{margin-bottom:16px;font-size:1.4rem;color:#fff}
    .card{background:#121822;border:1px solid #1e2a3a;border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 6px 14px rgba(0,0,0,.35)}
    label{display:block;margin-top:10px;margin-bottom:6px;font-size:.9rem;color:#cbd5e1}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #2a3a52;background:#0f141c;color:#e9eef5}
    textarea{min-height:84px;resize:vertical}
    button{padding:8px 14px;border-radius:10px;border:none;cursor:pointer;transition:opacity .2s}
    button:hover{opacity:.9}
    .danger{background:#ef4444;color:#fff}
    .primary{background:#1e90ff;color:#fff}
    .ghost{background:transparent;border:1px solid #2a3a52;color:#cbd5e1}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#132032;color:#9cc2ff;font-size:.85rem}
    .totals{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
    .totals div{background:#0f141c;border:1px solid #1f2a3a;border-radius:12px;padding:12px;text-align:center}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row > div { margin-left: 15px; margin-right: 15px; }
    .muted{color:#9fb1cc;font-size:.9rem}

    table.main-table{width:100%;border-collapse:separate;border-spacing:0 10px;margin-top:10px;display:block;overflow-x:auto;white-space:nowrap}
    th,td{text-align:center;padding:12px}
    .main-table th, .main-table td{min-width:120px}
    thead th{background:#1a2230;color:#cbd5e1;font-weight:600}
    tbody tr{background:#0f141c;border:1px solid #1f2a3a}
    tbody td{border-top:1px solid #1f2a3a}
    .col-planned, td.col-planned {min-width:130px}
    .col-paid, td.col-paid {min-width:130px}
    .col-due, td.col-due {min-width:140px}
    .main-table td input[type='number']{width:120px}
    .main-table td input[type='text']{width:160px}

    .status{font-weight:700}
    .status.Ù…Ø¯ÙÙˆØ¹{color:#22c55e}
    .status.Ù…Ø¯ÙÙˆØ¹-Ø¬Ø²Ø¦ÙŠ{color:#facc15}
    .status.ØºÙŠØ±-Ù…Ø¯ÙÙˆØ¹{color:#1e90ff}
    .status.Ø¯Ø®Ù„{color:#60a5fa}

    .mark{display:inline-block;margin-inline-start:8px;padding:2px 8px;border-radius:999px;font-size:.8rem;border:1px solid #2a3a52;background:#0f141c;color:#9cc2ff}

    .sub-table{margin-top:8px;border:1px solid #2a3a52;border-radius:10px;width:100%}
    .sub-table th{background:#1a2230;color:#9cc2ff}
    .sub-table td{background:#141c26}

    #history-chart-wrap{height:260px;position:relative;margin-top:16px}
    #delta-chart-wrap{height:240px;position:relative;margin-top:16px}
    #history-chart,#delta-chart{width:100% !important;height:100% !important;display:block}
  </style>































<style id="mobile-v36">
@media (max-width: 430px) {
  /* Lock horizontal scroll globally */
  html, body { margin:0; padding:0; width:100%; max-width:100%; overflow-x:hidden !important; }
  @supports (overflow: clip) { body { overflow-x: clip; } }
  *, *::before, *::after { box-sizing: border-box; }
  img, canvas, svg, video { max-width: 100%; height: auto; }

  /* Make table follow the page container width (not full-bleed) */
  #rows {
    width: 100% !important;
    max-width: 100% !important;
    table-layout: auto; border-collapse: separate; border-spacing: 0; direction: rtl;
    margin: 0 auto;
  }

  /* Card: 94% of container width (not vw), centered */
  #rows tr {
    display: grid;
    width: 94% !important;
    max-width: 94% !important;
    margin: 10px auto !important;
    grid-template-areas:
      "name   planned"
      "paid   due"
      "status actions"
      "detailsInput detailsToggle"
      "detailsPanel detailsPanel";
    grid-template-columns: 1fr 1fr;
    column-gap: 10px; row-gap: 8px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px; padding: 10px 12px;
    align-items: start; overflow: hidden;
  }

  #rows thead, #rows th { display: none !important; }

  #rows td:nth-child(1) { grid-area: name; }
  #rows td:nth-child(2) { grid-area: planned; }
  #rows td:nth-child(3) { grid-area: paid; }
  #rows td:nth-child(4) { grid-area: due; }
  #rows td:nth-child(5) { grid-area: status; }
  #rows td:nth-child(6) { grid-area: actions; }

  #rows td { position: relative; padding: 6px 4px; }
  #rows td::before {
    display:block; font-size:.95rem; font-weight:700; opacity:.95;
    margin-bottom:6px; line-height:1.15; color:#fff; text-align:center;
  }
  #rows td:nth-child(1)::before { content:"Ø§Ù„Ù…ØµØ±ÙˆÙ"; }
  #rows td:nth-child(2)::before { content:"Ø§Ù„Ù…Ø®Ø·Ø·"; }
  #rows td:nth-child(3)::before { content:"Ø§Ù„Ù…Ø¯ÙÙˆØ¹"; }
  #rows td:nth-child(4)::before { content:"Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"; }
  #rows td:nth-child(5)::before { content:"Ø§Ù„Ø­Ø§Ù„Ø©"; }
  #rows td:nth-child(6)::before { content:"Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"; }

  #rows input, #rows select, #rows textarea { width:100%; max-width:100%; padding:8px 10px; min-width:0; }

  #rows td:nth-child(1),
  #rows td:nth-child(2),
  #rows td:nth-child(3),
  #rows td:nth-child(4) { display:flex; flex-direction:column; align-items:center; text-align:center; }
  #rows td:nth-child(1) input { width:16ch; max-width:90%; margin:0 auto; }
  #rows td:nth-child(2) input, #rows td:nth-child(3) input, #rows td:nth-child(4) input { width:8ch; max-width:8ch; text-align:end; margin:0 auto; }

  #rows td:nth-child(6) { display:flex; flex-direction:column; align-items:center; gap:8px; text-align:center; }
  #rows td:nth-child(6) .btn, #rows td:nth-child(6) button { padding:8px 10px; line-height:1.2; font-size:.95rem; }
  #rows td:nth-child(6) .is-details-btn { display:none !important; }

  #rows td.mobile-details-input::before  { content:"Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„"; text-align:center; width:100%; }
  #rows td.mobile-details-toggle::before { content:"Ø§Ù„ØªÙØ§ØµÙŠÙ„"; text-align:center; width:100%; }
  #rows td.mobile-details-input, #rows td.mobile-details-toggle { display:flex; flex-direction:column; align-items:center; gap:6px; }
  #rows td.mobile-details-input button, #rows td.mobile-details-toggle button { padding:8px 10px; -webkit-appearance:none; appearance:none; }

  #rows td.mobile-details-panel {
    grid-area: detailsPanel; border:1px dashed rgba(255,255,255,0.15);
    border-radius:10px; padding:10px; display:none; width:100%; box-sizing:border-box;
  }
  #rows td.mobile-details-panel .placeholder { opacity:.8; font-size:.95rem; text-align:center; padding:4px 0; }
  #rows td.mobile-details-panel .details-list { display:flex; flex-direction:column; gap:8px; }
  #rows td.mobile-details-panel .detail-item { display:grid; grid-template-columns:1fr 9ch 34px; gap:8px; align-items:center; }
  #rows td.mobile-details-panel .detail-item input[type="text"] { width:100%; }
  #rows td.mobile-details-panel .detail-item input[data-role="value"] { width:9ch; max-width:9ch; text-align:end; direction:ltr; }
  #rows td.mobile-details-panel .detail-item button.del { background:#c0392b; color:#fff; border:none; border-radius:8px; width:34px; height:34px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:1rem; }

  #rows tr * { min-width:0; max-width:100%; }
}
</style>


<style id="mobile-v37">
@media (max-width: 430px){
  #rows { width:95% !important; max-width:95% !important; margin:0 auto; }
}
</style>

</head>
<body>
  <h1>ğŸ’° Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ</h1>

  <!-- (1) Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ù‚ÙˆØ§Ù„Ø¨ -->
  <div class="card">
    <div class="row">
      <div style="flex:1 1 200px">
        <label>Ø§Ù„Ø³Ù†Ø©</label>
        <input id="year-input" type="number" />
      </div>
      <div style="flex:1 1 220px">
        <label>Ø§Ù„Ø´Ù‡Ø± (Ù…ÙŠÙ„Ø§Ø¯ÙŠ)</label>
        
        <select id="month-select">
          <option value="01">ÙŠÙ†Ø§ÙŠØ±</option>
          <option value="02">ÙØ¨Ø±Ø§ÙŠØ±</option>
          <option value="03">Ù…Ø§Ø±Ø³</option>
          <option value="04">Ø£Ø¨Ø±ÙŠÙ„</option>
          <option value="05">Ù…Ø§ÙŠÙˆ</option>
          <option value="06">ÙŠÙˆÙ†ÙŠÙˆ</option>
          <option value="07">ÙŠÙˆÙ„ÙŠÙˆ</option>
          <option value="08">Ø£ØºØ³Ø·Ø³</option>
          <option value="09">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
          <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
          <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
          <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>

      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="save-template" class="primary">ğŸ’¾ Ø­ÙØ¸ ÙƒÙ‚Ø§Ù„Ø¨</button>
      <div style="flex:1 1 260px">
        <label>Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨</label>
        <div class="row">
          <select id="templates-select" style="flex:1 1 220px"></select>
          <button id="apply-template" class="ghost">ØªØ·Ø¨ÙŠÙ‚</button>
          <button id="delete-template" class="danger">Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨</button>
        </div>
      </div>
      <button id="close-month" class="primary">ğŸ“¦ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ù‡Ø± ÙˆØ­ÙØ¸Ù‡</button>
      <button id="reset" class="danger">ØªÙØ±ÙŠØº Ø§Ù„ÙƒÙ„</button>
      <button id="export-history" class="ghost">ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø±Ø´ÙŠÙ JSON</button>
      <button id="export-csv" class="ghost">ØªØµØ¯ÙŠØ± CSV</button>
      <input type="file" id="import-history" accept="application/json" style="display:none" />
      <button id="import-history-btn" class="ghost">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø±Ø´ÙŠÙ</button>
    </div>
  </div>

  <!-- (2) Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
  <div class="card">
    <h3>ğŸ’µ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±Ø§ØªØ¨)</h3>
    <div class="row" style="align-items:flex-end">
      <div style="flex:1 1 260px">
        <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
        <input id="salary2" type="number" placeholder="" />
      </div>
    </div>
  </div>

  <!-- (3) Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ + Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
  <div class="card">
    <h3>â• Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ø¯Ø®Ù„</label>
    <input id="extra-name" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù…Ù„ Ø¥Ø¶Ø§ÙÙŠ" />
    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ø®Ù„</label>
    <input id="extra-amount" type="number" />
    <button id="add-extra" class="primary" style="margin-top:10px">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø®Ù„</button>
    <table class="main-table">
      <thead>
        <tr>
          <th>Ø¯Ø®Ù„</th>
          <th class="col-paid">Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody id="extras-rows"></tbody>
    </table>
  </div>

  <div class="card">
    <h3>ğŸ§¾ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
    <div class="row" style="gap:8px">
      
      <select id="name" style="flex:1 1 220px">
        <option>Ø³ÙƒÙ†</option>
        <option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
        <option>Ù…Ø§Ø¡</option>
        <option>Ø¥Ù†ØªØ±Ù†Øª</option>
        <option>ØºØ§Ø²</option>
        <option>Ø§ØªØµØ§Ù„Ø§Øª</option>
        <option>Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª</option>
        <option>Ù…Ø·Ø§Ø¹Ù…</option>
        <option>ØªØ±ÙÙŠÙ‡</option>
        <option>ÙˆÙ‚ÙˆØ¯</option>
        <option>Ù…ÙˆØ§ØµÙ„Ø§Øª</option>
        <option>ØªØ¹Ù„ÙŠÙ…</option>
        <option>ØµØ­Ø©</option>
        <option>Ù…Ù„Ø§Ø¨Ø³</option>
        <option>Ù‡Ø¯Ø§ÙŠØ§</option>
        <option>Ø¬Ù…Ø¹ÙŠØ©</option>
        <option>Ø£Ù‚Ø³Ø§Ø·</option>
        <option>ØµØ¯Ù‚Ø§Øª</option>
        <option>Ø£Ø®Ø±Ù‰</option>
      </select>

      <input id="name-custom" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ù„Ùˆ Ø§Ø®ØªØ±Øª (Ø£Ø®Ø±Ù‰)" style="flex:1 1 220px" />
      <button id="save-custom-cat" class="ghost">ğŸ’¾ Ø­ÙØ¸ ÙƒØ®ÙŠØ§Ø± Ø¯Ø§Ø¦Ù…</button>
      <button id="delete-cat" class="danger">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</button>
    </div>
    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®Ø·Ø·</label><input id="planned" type="number" />
    <label>Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</label><input id="paid" type="number" />
    <button id="add" type="button" class="primary" style="margin-top:12px" onclick="return addItemInline(event)" ontouchend="return addItemInline(event)">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>

    <table class="main-table">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
          <th class="col-planned">Ø§Ù„Ù…Ø®Ø·Ø·</th>
          <th class="col-paid">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
          <th class="col-due">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
    <div class="totals">
      <div><div class="pill">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø·Ø·</div><h3 id="t_planned">0</h3></div>
      <div><div class="pill">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹</div><h3 id="t_paid">0</h3></div>
      <div><div class="pill">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù†ÙˆØ¯</div><h3 id="t_due">0</h3></div>
      <div><div class="pill">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div><h3 id="t_balance">0</h3></div>
    </div>
  </div>

  <!-- (4) Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©: Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª -->
  <div class="card">
    <h3>ğŸ“ˆ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª</h3>
    <p class="muted">Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø© ØªÙ…Ø§Ù…Ù‹Ø§ ÙˆÙ„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø£Ùˆ Ø§Ù„Ø£Ø±ØµØ¯Ø©.</p>
    <div class="row">
      <div style="flex:1 1 220px">
        <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</label>
        <input id="inv-type" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø³Ù‡Ù…ØŒ Ø¨ÙŠØªÙƒÙˆÙŠÙ†ØŒ Ø¹Ù‚Ø§Ø±" />
      </div>
      <div style="flex:1 1 220px">
        <label>Ø§Ù„ÙˆØ¬Ù‡Ø© / Ø£ÙŠÙ† Ø°Ù‡Ø¨Øª Ø§Ù„Ø£Ù…ÙˆØ§Ù„</label>
        <input id="inv-dest" placeholder="Ù…Ø«Ø§Ù„: TeslaØŒ BTC WalletØŒ ØµÙ†Ø¯ÙˆÙ‚ Ù…Ø¤Ø´Ø±" />
      </div>
      <div style="flex:1 1 180px">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±)</label>
        <input id="inv-amount" type="number" />
      </div>
      <div style="flex:1 1 220px">
        <label>Ù…ØµØ¯Ø± Ø§Ù„Ø£Ù…ÙˆØ§Ù„</label>
        <input id="inv-source" placeholder="Ø±Ø§ØªØ¨ØŒ Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠØŒ Ø³Ø­Ø¨ Ù…Ù† Ø§Ø¯Ø®Ø§Ø±..." />
      </div>
    </div>
    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª / ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <textarea id="inv-notes" placeholder="ØªÙØ§ØµÙŠÙ„ Ù…Ø«Ù„: Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„ÙˆØ³ÙŠØ·ØŒ Ø±Ø³ÙˆÙ…..."></textarea>
    <button id="add-inv" class="primary" style="margin-top:12px">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø³ØªØ«Ù…Ø§Ø±</button>

    <table class="main-table">
      <thead>
        <tr>
          <th>Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„ÙˆØ¬Ù‡Ø©</th>
          <th class="col-paid">Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„Ù…ØµØ¯Ø±</th>
          <th>Ø§Ù„Ø´Ù‡Ø±</th>
          <th>ØªÙØ§ØµÙŠÙ„</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody id="inv-rows"></tbody>
    </table>
  </div>

  <!-- (5) Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©: Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
  <div class="card">
    <h3>ğŸ“š Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
    <div class="row" style="margin-bottom:10px">
      <div style="flex:1 1 220px">
        <label>Ø§Ø®ØªØ± Ø´Ù‡Ø±Ù‹Ø§</label>
        <select id="history-select"></select>
      </div>
      <button id="delete-month" class="danger">Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</button>
    </div>
    <div id="history-kpis" class="totals"></div>
    <div id="history-table-wrap"></div>

    <div id="history-chart-wrap">
      <canvas id="history-chart"></canvas>
    </div>

    <div id="delta-chart-wrap">
      <canvas id="delta-chart"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const $=id=>document.getElementById(id);
    const STORE_KEY='budget-mini-v5';
    const HISTORY_KEY='budget-history-v5';
    const TEMPLATES_KEY='budget-templates-v4'; // Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙƒÙ…Ø§ Ù‡ÙŠ
    const CATS_KEY='budget-custom-cats-v1';
    const DELETED_CATS_KEY='budget-deleted-cats-v1';

    let state={salary:0,items:[],extras:[],investments:[]};
    // Ø¬Ø±Ù‘Ø¨ ØªØ­Ù…ÙŠÙ„ Ø¥ØµØ¯Ø§Ø±Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª
    const legacyStoreV4 = JSON.parse(localStorage.getItem('budget-mini-v4')||'null');
    if(!localStorage.getItem(STORE_KEY) && legacyStoreV4){
      state = { ...legacyStoreV4, investments: legacyStoreV4.investments || [] };
      localStorage.setItem(STORE_KEY, JSON.stringify(state));
    }

    // Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø­ØªÙ‰ ÙÙŠ Ø­Ø§Ù„Ø§Øª Safari/iOS

    // Ø¶Ù…Ø§Ù† ØªØ¹Ø¨Ø¦Ø© ÙƒÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© (Ø§Ù„Ø´Ù‡ÙˆØ±ØŒ Ø§Ù„ÙØ¦Ø§ØªØŒ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ØŒ Ø§Ù„Ø£Ø±Ø´ÙŠÙ)
    function ensureSelectPopulated(id, fillerFn, fallbackBuilder) {
      const sel = $(id);
      let tries = 0;
      const tick = () => {
        tries++;
        try {
          if (sel && sel.options and sel.options.length === 0) {
            if (typeof fillerFn === 'function') fillerFn();
          }
          if (sel && sel.options && sel.options.length === 0 and typeof fallbackBuilder === 'function') {
            const opts = fallbackBuilder();
            if (Array.isArray(opts) and opts.length) {
              opts.forEach(o => {
                const opt = document.createElement('option');
                opt.value = o.value;
                opt.textContent = o.text;
                sel.appendChild(opt);
              });
            }
          }
        } catch(e){}
        if (sel && sel.options && sel.options.length === 0 and tries < 6) {
          setTimeout(tick, 200);
        }
      };
      setTimeout(tick, 120);
    }

    function runEnsures(){
      ensureSelectPopulated('month-select', fillMonths, () => [
        {value:'01', text:'ÙŠÙ†Ø§ÙŠØ±'},{value:'02', text:'ÙØ¨Ø±Ø§ÙŠØ±'},{value:'03', text:'Ù…Ø§Ø±Ø³'},
        {value:'04', text:'Ø£Ø¨Ø±ÙŠÙ„'},{value:'05', text:'Ù…Ø§ÙŠÙˆ'},{value:'06', text:'ÙŠÙˆÙ†ÙŠÙˆ'},
        {value:'07', text:'ÙŠÙˆÙ„ÙŠÙˆ'},{value:'08', text:'Ø£ØºØ³Ø·Ø³'},{value:'09', text:'Ø³Ø¨ØªÙ…Ø¨Ø±'},
        {value:'10', text:'Ø£ÙƒØªÙˆØ¨Ø±'},{value:'11', text:'Ù†ÙˆÙÙ…Ø¨Ø±'},{value:'12', text:'Ø¯ÙŠØ³Ù…Ø¨Ø±'},
      ]);
      ensureSelectPopulated('name', refreshCats, () => (defaultCats||[]).map(c=>({value:c,text:c})) );
      ensureSelectPopulated('templates-select', refreshTemplates, () => [{value:'', text:'â€” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ â€”'}]);
      ensureSelectPopulated('history-select', refreshHistorySelect, () => [{value:'', text:'â€” Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ø´ÙŠÙ â€”'}]);
    }

    function ensureCatsRetries() {
      const sel = $('name');
      let attempts = 0;
      const tick = () => {
        attempts++;
        if (sel && sel.options && sel.options.length === 0) {
          try { refreshCats(); } catch(e){}
        }
        if (sel && sel.options && sel.options.length === 0 && attempts < 5) {
          setTimeout(tick, 200);
        }
      };
      setTimeout(tick, 150);
    }

    let budgetHistory = load(HISTORY_KEY) || {};
    // ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ù† ÙˆØ¬Ø¯ (v4)
    const legacyHistoryV4 = JSON.parse(localStorage.getItem('budget-history-v4')||'null');
    if(!Object.keys(budgetHistory).length && legacyHistoryV4){
      budgetHistory = legacyHistoryV4; save(HISTORY_KEY,budgetHistory);
    }

    let templates = load(TEMPLATES_KEY) || {};
    let customCats = load(CATS_KEY) || [];
    let deletedCats = load(DELETED_CATS_KEY) || [];

    let historyChart=null, deltaChart=null;

    function load(key){ try{ return JSON.parse(localStorage.getItem(key)||'null') }catch{ return null } }
    function save(key,val){ localStorage.setItem(key, JSON.stringify(val)) }
    function persist(){ save(STORE_KEY,state) }

    function normalizeCat(s){ return (s||'').trim().replace(/\s+/g,' '); }

    function monthNow(){ const d=new Date();const m=(d.getMonth()+1).toString().padStart(2,'0');return `${d.getFullYear()}-${m}`; }

    // Ø§Ù„Ø´Ù‡ÙˆØ±
    const months = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
    function fillMonths(){
      const sel=$('month-select'); sel.innerHTML='';
      months.forEach((m,i)=>{ const v=(i+1).toString().padStart(2,'0'); const opt=document.createElement('option'); opt.value=v; opt.textContent=m; sel.appendChild(opt); });
    }

    // ... (remaining JS unchanged for brevity in this embedding)
  </script>





<script id="mobile-v29-enhance">
(function(){
  if (window.__mobileEnhanceV29Installed) return;
  window.__mobileEnhanceV29Installed = true;
  /* ... rest of the script unchanged ... */
})();
</script>
</body>
</html>